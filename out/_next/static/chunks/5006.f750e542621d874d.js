"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5006],{15006:(e,i,s)=>{s.r(i),s.d(i,{default:()=>x});var t=s(95155),a=s(81266),r=s.n(a);class n extends r().Scene{preload(){let{width:e,height:i}=this.cameras.main;this.assetText=this.make.text({x:e/2,y:i/2-75,text:"Loading...",style:{font:"20px monospace",fill:"#ffffff"}}).setOrigin(.5,.5),this.load.on("progress",this.onProgress,this),this.load.on("fileprogress",this.onFileProgress,this),this.load.multiatlas("atlas_object","resource/atalas/atlas_object.json","resource/atalas"),this.load.multiatlas("mario-sprites","resource/atalas/mario-sprites.json","resource/atalas"),this.load.bitmapFont("font","resource/fonts/font.png","resource/fonts/font.fnt"),this.load.tilemapTiledJSON({key:"level1",url:"resource/tilemap/level1.json"}),this.load.spritesheet("brick","resource/img/Levels/brick.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("blockCollisioned","resource/img/Levels/blockCollisioned.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("brick2","resource/img/Levels/brick2.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("randomBox","resource/img/Levels/questionMarkBlock.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("randomBox2","resource/img/Levels/questionMarkBlock_2.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("brickCoins","resource/img/Levels/brickCoins.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("brickCoins2","resource/img/Levels/brickCoins_2.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("coinBlock","resource/img/Items/coinBlock.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("mushroom","resource/img/Items/mushroom.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("flower","resource/img/Items/flower.png",{frameWidth:16,frameHeight:16}),this.load.image("tileset_levels","resource/tilemap/tileset_levels.png"),this.load.image("red","resource/particles/red.png"),this.load.spritesheet("small_mario","resource/tilemap/small_mario.png",{frameWidth:480,frameHeight:480}),this.load.spritesheet("small_mario_skin","resource/tilemap/small_mario_special.png",{frameWidth:480,frameHeight:480}),this.load.spritesheet("big_mario","resource/tilemap/big_mario.png",{frameWidth:16,frameHeight:32}),this.load.spritesheet("goomba_red","resource/img/Enemies/Goomba/goomba_red.png",{frameWidth:480,frameHeight:480}),this.load.image("initTexture","resource/img/Items/coin.png"),this.load.image("heart","resource/icons/heart.png"),this.load.image("perkOne","resource/icons/skin.png"),this.load.image("perkTwo","resource/icons/perk2.png"),this.load.image("perkThree","resource/icons/perk3.png"),this.load.spritesheet("koopa_green","resource/img/Enemies/Koopa/koopa_green.png",{frameWidth:16,frameHeight:24}),this.load.spritesheet("koopa_green_squish","resource/img/Enemies/Koopa/koopa_green_squish.png",{frameWidth:16,frameHeight:16}),this.load.pack("Preload","resource/pack.json","Preload")}sleep(e){return new Promise(i=>{setTimeout(i,e)})}async create(){var e;let i,s;console.log("Creazione..."),this.buildAnimations(),e=this,i={key:"brickTile",frames:e.anims.generateFrameNumbers("tiles",{start:14,end:14,first:14})},e.anims.create(i),i={key:"blockTile",frames:e.anims.generateFrameNumbers("tiles",{start:43,end:43,first:43})},e.anims.create(i),["","Super","Fire"].forEach(s=>{i={key:"run"+s,frames:e.anims.generateFrameNames("mario-sprites",{prefix:"mario/walk"+s,start:1,end:3}),frameRate:10,repeat:-1,repeatDelay:0},e.anims.create(i),["jump","stand","turn","bend"].forEach(t=>{("bend"!==t||""!==s)&&(i.key=t+s,i.frames=[{frame:"mario/"+t+s,key:"mario-sprites"}],e.anims.create(i))}),i.key="climb"+s,i.frames=e.anims.generateFrameNames("mario-sprites",{prefix:"mario/climb"+s,start:1,end:2}),e.anims.create(i),i.key="swim"+s,i.frames=e.anims.generateFrameNames("mario-sprites",{prefix:"mario/swim"+s,start:1,end:6}),e.anims.create(i)}),i.key="death",i.frames=e.anims.generateFrameNumbers("mario",{start:22,end:22}),e.anims.create(i),s=[],["mario/half","mario/stand","mario/half","mario/standSuper","mario/half","mario/standSuper"].forEach(e=>{s.push({frame:e,key:"mario-sprites"})}),i={key:"grow",frames:s,frameRate:10,repeat:0,repeatDelay:0},e.anims.create(i),i={key:"shrink",frames:s.reverse(),frameRate:10,repeat:0,repeatDelay:0},e.anims.create(i),i={key:"goomba",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"goomba/walk",start:1,end:2}),frameRate:5,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"goombaFlat",frames:[{key:"mario-sprites",frame:"goomba/flat"}]},e.anims.create(i),i={key:"turtle",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"turtle/turtle",end:1}),frameRate:5,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"mario/climb",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"mario/climb",end:1}),frameRate:5,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"mario/climbSuper",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"mario/climbSuper",end:1}),frameRate:5,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"flag",frames:[{key:"mario-sprites",frame:"flag"}],repeat:-1},e.anims.create(i),i={key:"turtleShell",frames:[{frame:"turtle/shell",key:"mario-sprites"}]},e.anims.create(i),i={key:"mushroom",frames:[{frame:"powerup/super",key:"mario-sprites"}]},e.anims.create(i),i={key:"coin",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"coin/spin",start:1,end:4}),frameRate:30,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"1up",frames:[{frame:"powerup/1up",key:"mario-sprites"}]},e.anims.create(i),i={key:"flower",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"powerup/flower",start:1,end:4}),frameRate:30,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"star",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"powerup/star",start:1,end:4}),frameRate:30,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"dpad",frames:[{frame:"controller/dpad",key:"mario-sprites"}]},e.anims.create(i),i={key:"button",frames:[{frame:"controller/button",key:"mario-sprites"}]},e.anims.create(i),i={key:"fireFly",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"fire/fly",start:1,end:4}),frameRate:10,repeat:-1,repeatDelay:0},e.anims.create(i),i={key:"fireExplode",frames:e.anims.generateFrameNames("mario-sprites",{prefix:"fire/explode",start:1,end:3}),frameRate:30,repeat:0,repeatDelay:0},e.anims.create(i),this.scene.start("GameScene")}buildAnimations(){this.anims.create({key:"left_anim",frames:this.anims.generateFrameNames("small_mario",{start:7,end:9}),frameRate:8,repeat:-1}),this.anims.create({key:"right_anim",frames:this.anims.generateFrameNames("small_mario",{start:3,end:5}),frameRate:8,repeat:-1}),this.anims.create({key:"faceRight_anim",frames:this.anims.generateFrameNames("small_mario",{start:1,end:1}),frameRate:1,repeat:-1}),this.anims.create({key:"faceLeft_anim",frames:this.anims.generateFrameNames("small_mario",{start:11,end:11}),frameRate:1,repeat:1}),this.anims.create({key:"jumpRight_anim",frames:this.anims.generateFrameNames("small_mario",{start:5,end:5}),frameRate:1,repeat:1}),this.anims.create({key:"jumpLeft_anim",frames:this.anims.generateFrameNames("small_mario",{start:7,end:7}),frameRate:1,repeat:1}),this.anims.create({key:"die_anim",frames:this.anims.generateFrameNames("small_mario",{start:6,end:6}),frameRate:1,repeat:1})}onProgress(e){if(this.preloadSprite){var i=Math.floor(this.preloadSprite.width*e);this.preloadSprite.sprite.frame.width=i,this.preloadSprite.sprite.frame.cutWidth=i,this.preloadSprite.sprite.frame.updateUVs()}}onFileProgress(e){try{this.assetText.setText("正在加载: "+e.src)}catch(e){console.log(e)}}constructor(){super({key:"PreLoadScene"})}}class h extends Phaser.GameObjects.Sprite{fire(e,i,s){this.body.allowGravity=!0,this.setPosition(e,i),this.body.velocity.x=200*(s?-1:1),this.play("fireFly")}update(){}collided(){0===this.body.velocity.y&&(this.body.velocity.y=-150),0===this.body.velocity.x&&this.explode()}explode(){this.body.allowGravity=!1,this.body.velocity.y=0,this.hasCollided||(this.play("fireExplode"),this.hasCollided=!0,this.once("animationcomplete",function(){this.scene.playerAttackGroup.remove(this,!0,!0)},this))}constructor(e){super(e.scene,e.x,e.y,"atlas_object","Player/Mario_Fire/fireBall_01"),e.scene.physics.world.enable(this),this.scene=e.scene,this.damage=1,this.hasCollided=!1,this.body.setSize(8,8),this.body.setOffset(0,0),this.scene.add.existing(this)}}class o extends Phaser.Physics.Arcade.Sprite{update(){}collidingBricksCoin(){this.scene.tweens.add({targets:[this],y:this.y-2*this.height,duration:200,callbackScope:this,ease:"Quintic",yoyo:!0,onComplete:()=>{this.scene.score+=50,this.destroy()}})}collidingWithPlayer(){this.scene.score+=50,this.destroy()}constructor(e){super(e.scene,e.x,e.y,"initTexture"),e.scene.physics.world.enable(this),this.scene=e.scene,this.number=e.number,this.scene.add.existing(this),this.scene.physics.world.enable(this),this.alive=!0,this.body.allowGravity=!1,this.anims.play("coinBlock_anim")}}class m extends Phaser.Physics.Arcade.Sprite{update(){this.body.onWall()&&(this.direction*=-1),this.body.velocity.x=this.direction*this.speed}collidingBricks(){this.scene.tweens.add({targets:[this],y:this.y-2*this.height,duration:200,callbackScope:this,ease:"Quintic",yoyo:!0,onComplete:()=>{}}),this.scene.player.x-this.x>=this.body.halfWidth?this.direction=-1:this.direction=1}collidingWithPlayer(e,i){e.changeMode("upgrade"),this.destroy()}constructor(e){super(e.scene,e.x,e.y,"initTexture"),e.scene.physics.world.enable(this),this.scene=e.scene,this.scene.add.existing(this),this.scene.physics.world.enable(this),this.alive=!0,this.direction=1,this.speed=60,this.life=1,this.scene.physics.add.collider(this,this.scene.graphicLayer,()=>{}),this.anims.play("mushroom_anim")}}class l extends m{update(){}collidingBricks(){this.scene.tweens.add({targets:[this],y:this.y-2*this.height,duration:200,callbackScope:this,ease:"Quintic",yoyo:!0,onComplete:()=>{}})}constructor(e){super(e),this.anims.play("flower_anim"),this.body.allowGravity=!1}}class c extends Phaser.Physics.Arcade.Sprite{update(e,i){if(this.timeManage.nowTime=e,!this.hasSkin&&JSON.parse(localStorage.getItem("sustainabilityScore"))>0&&(this.hasSkin=!0),this.alive){if(this.isJumping=this.body.blocked.none&&0!==this.body.velocity,this.keys.down.isDown)this.bigMode&&this.anims.play("bigSquat_anim");else if(this.keys.left.isDown){if(this.direction=-1,this.body.velocity.x=this.direction*this.speed,this.isJumping)return;this.bigMode?this.anims.play("bigLeft_anim",!0):this.hasSkin?this.anims.play("skinLeft_anim",!0):this.anims.play("left_anim",!0)}else if(this.keys.right.isDown){if(this.direction=1,this.body.velocity.x=this.direction*this.speed,this.isJumping)return;this.bigMode?this.anims.play("bigRight_anim",!0):this.hasSkin?this.anims.play("skinRight_anim",!0):this.anims.play("right_anim",!0)}else this.keys.up.isDown&&this.body.blocked.down?this.jump():this.isJumping?1===this.direction?this.bigMode?this.anims.play("bigJumpRight_anim",!0):this.hasSkin?this.anims.play("skinJumpRight_anim",!0):this.anims.play("jumpRight_anim",!0):this.bigMode?this.anims.play("bigJumpLeft_anim",!0):this.hasSkin?this.anims.play("skinJumpLeft_anim",!0):this.anims.play("jumpLeft_anim",!0):(this.body.velocity.x=0,1===this.direction?this.bigMode?this.anims.play("bigFaceRight_anim",!0):this.hasSkin?this.anims.play("skinFaceRight_anim",!0):this.anims.play("faceRight_anim",!0):this.bigMode?this.anims.play("bigFaceLeft_anim",!0):this.hasSkin?this.anims.play("skinFaceLeft_anim",!0):this.anims.play("faceLeft_anim",!0))}else this.die()}jump(){this.body.velocity.y=-1*this.jumpSpeed}changeMode(e){let i=[()=>{this.life--,this.alive=!1,this.direction=0,this.body.velocity.x=0,this.emitter.stopFollow(this),this.emitter.explode()},this.hasSkin?()=>{this.bigMode=!1,this.ability.fireball=!1,this.ability.invincible=!1,console.log(this.scene),this.setSize(16,16),this.setOffset(0,0)}:()=>{this.bigMode=!1,this.ability.fireball=!1,this.ability.invincible=!1,this.setTexture("small_mario_skin",this.anims.currentFrame.index),console.log(this.scene)},()=>{this.bigMode=!0,this.ability.fireball=!1,this.ability.invincible=!1,this.setSize(16,32),this.setOffset(0,0),this.setScale(1),this.y-=16,this.emitter.stopFollow(this)},()=>{this.bigMode=!0,this.ability.fireball=!0,this.emitter.startFollow(this)}];"upgrade"===e?this.currentModeIndex=this.currentModeIndex<i.length-1?++this.currentModeIndex:this.currentModeIndex:"downgrade"===e?this.currentModeIndex=this.currentModeIndex>0?--this.currentModeIndex:0:"die"===e&&(this.currentModeIndex=0),i[this.currentModeIndex]()}small(){this.body.setSize(10,10)}large(){this.body.setSize(10,22),this.body.offset.set(3,10)}creatAnims(){this.scene.anims.create({key:"bigRight_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:2,end:4}),frameRate:8,repeat:-1}),this.scene.anims.create({key:"bigLeft_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:8,end:10}),frameRate:8,repeat:-1}),this.scene.anims.create({key:"bigFaceRight_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:1,end:1}),frameRate:1,repeat:1}),this.scene.anims.create({key:"bigFaceLeft_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:11,end:11}),frameRate:1,repeat:1}),this.scene.anims.create({key:"bigJumpRight_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:5,end:5}),frameRate:1,repeat:1}),this.scene.anims.create({key:"bigJumpLeft_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:7,end:7}),frameRate:1,repeat:1}),this.scene.anims.create({key:"bigSquat_anim",frames:this.scene.anims.generateFrameNumbers("big_mario",{start:6,end:6}),frameRate:1,repeat:1}),this.scene.anims.create({key:"skinLeft_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:7,end:9}),frameRate:8,repeat:-1}),this.scene.anims.create({key:"skinRight_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:3,end:5}),frameRate:8,repeat:-1}),this.scene.anims.create({key:"skinFaceRight_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:1,end:1}),frameRate:1,repeat:-1}),this.scene.anims.create({key:"skinFaceLeft_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:11,end:11}),frameRate:1,repeat:1}),this.scene.anims.create({key:"skinJumpRight_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:5,end:5}),frameRate:1,repeat:1}),this.scene.anims.create({key:"skinJumpLeft_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:7,end:7}),frameRate:1,repeat:1}),this.scene.anims.create({key:"skinDie_anim",frames:this.scene.anims.generateFrameNames("small_mario_skin",{start:6,end:6}),frameRate:1,repeat:1})}creatControls(){this.keys={left:this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),down:this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),right:this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),up:this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),fire:this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE)},this.scene.input.on("pointerdown",this.handleFire,this),this.scene.input.keyboard.on("keydown",e=>{"Space"===e.code&&this.handleFire()})}handleFire(){if(this.ability.fireball){let e=new h({scene:this.scene,x:this.x,y:this.y});this.scene.playerAttackGroup.add(e),e.fire(this.x,this.y,1!==this.direction)}}collidingWithbricksCoinGroup(e,i){!0!==i.isCollided&&e.body.touching.up&&i.body.touching.down&&(i.isCollided=!0,this.scene.tweens.add({targets:i,y:i.y-8,callbackScope:this,duration:100,ease:"Quintic",yoyo:!0,onComplete:function(e){i.anims.play("blockCollisioned_anim")}}),new o({scene:this.scene,x:i.x+8,y:i.y+8-16}).collidingBricksCoin())}collidingWithbricksGroup(e,i){e.body.touching.up&&i.body.touching.down&&(this.bigMode?i.destroy():this.scene.tweens.add({targets:i,y:i.y-8,callbackScope:this,duration:100,ease:"Quintic",yoyo:!0,onComplete:function(e){}}))}collidingWithbricksFlowerOrMushroomGroup(e,i){if(!0!==i.isCollided&&e.body.touching.up&&i.body.touching.down){let e;i.isCollided=!0,this.scene.tweens.add({targets:i,y:i.y-8,callbackScope:this,duration:100,ease:"Quintic",yoyo:!0,onComplete:function(e){i.anims.play("blockCollisioned_anim")}}),e=this.currentModeIndex>=2?new l({scene:this.scene,x:i.x+8,y:i.y+8-16}):new m({scene:this.scene,x:i.x+8,y:i.y+8-16}),this.scene.mushroomOrFlowerGroup.add(e),e.collidingBricks()}}die(){if(!this.dieAnimPlaying){this.dieAnimPlaying=!0,this.anims.play("die_anim"),this.scene.cameras.main.stopFollow();let e=this.scene.tweens.createTimeline();e.add({targets:this,y:this.y-16,ease:"Power1",duration:600}),e.add({targets:this,y:this.y+600,ease:"Power1",duration:2e3,onComplete:e=>{this.life>0?this.scene.restartGame():this.scene.scene.start("gameOverScene",{result:"lose",score:this.scene.score})}}),e.play()}}getDamageHandler(e){this.alive&&("deadZone"===e.type?this.changeMode("die"):"enemy"===e.type&&(this.ability.invincible||this.ability.immune||(this.changeMode("downgrade"),this.setImmune(1e3))))}setImmune(e){this.ability.immune=!0,setTimeout(()=>{this.ability.immune=!1},e)}constructor(e,i){super(e.scene,e.x,e.y,"initTexture"),this.scaleX=.07,this.scaleY=this.scaleX,this.hasSkin=!1,this.scene=e.scene,this.scene.add.existing(this),this.scene.physics.world.enable(this),this.setCollideWorldBounds(!0),this.bigMode=!1,this.fireMode=!1,this.direction=1,this.speed=150,this.jumpSpeed=210;let s=localStorage.getItem("sustainabilityScore");JSON.parse(s)>1&&(this.jumpSpeed=400,JSON.parse(s)>2&&(this.speed=350)),this.life=i.life||3,this.alive=!0,this.isJumping=!1,this.ability={fireball:!1,invincible:!1,immune:!1},this.timeManage={nowTime:0,startInvincible:0,overInvincible:0},this.currentModeIndex=1,this.dieAnimPlaying=!1;let t=this.scene.add.particles("red");this.emitter=t.createEmitter({radial:!1,lifespan:1e3,quantity:4,scale:{start:.6,end:0,ease:"Power3"},blendMode:"ADD"}),this.creatAnims(),this.creatControls(),this.eventEmitter=new Phaser.Events.EventEmitter,this.eventEmitter.on("getDamage",this.getDamageHandler,this)}}class d extends Phaser.Physics.Arcade.Sprite{update(){if(!(Math.abs(this.x-this.scene.player.x)>=450)&&this.alive){if(this.life<=0)return this.alive=!1,this.dieSetting(),!1;this.body.onWall()&&(this.direction*=-1),this.body.velocity.x=this.direction*this.speed}}dieSetting(){this.life=0,this.alive=!1,this.direction=0,this.body.velocity.x=0,setTimeout(()=>{this.scene&&this.scene.enemiesGroup.remove(this,!0,!0)},2e3)}collidingWithFireball(){if(this.alive){this.scene.score+=10,this.angle=-180;let e=this.scene.tweens.createTimeline();e.add({targets:this,y:this.y-16,ease:"Power1",duration:600}),e.add({targets:this,y:this.y+600,ease:"Power1",duration:3e3}),e.play(),this.dieSetting()}}fallInDeadZone(){this.alive&&this.dieSetting()}constructor(e,i,s,t){super(e,i,s,t),e.physics.world.enable(this),this.scene=e,this.scene.add.existing(this),this.scene.physics.world.enable(this),this.direction=-1,this.speed=30,this.life=1,this.alive=!0,this.scene.physics.add.collider(this,this.scene.graphicLayer,()=>{}),this.type="enemy"}}class p extends d{collidingWithPlayer(){this.body.touching.up&&this.scene.player.body.touching.down?(this.dieSetting(),this.scene.score+=20,this.anims.play("goombaDie_anim")):this.alive&&this.scene.player.eventEmitter.emit("getDamage",this)}constructor(e,i,s,t){super(e,i,s,t),this.anims.play("goombaWalk_anim")}}class y extends d{update(e,i){if(!(Math.abs(this.x-this.scene.player.x)>=450)&&(this.timeManage.nowTime=e,this.alive)){if(this.life<=0)return this.alive=!1,this.dieSetting(),!1;if(this.isSquished){if(this.isSquishFly?(this.speed=300,this.scene.physics.world.collide(this,this.scene.enemiesGroup,(e,i)=>{i.collidingWithFireball()})):this.speed=30,this.timeManage.startRecover<this.timeManage.nowTime&&this.timeManage.recoverFinish>this.timeManage.nowTime&&!this.isSquishFly){if(this.onRecover)return;this.anims.play("koopaSquishRecover_anim"),this.onRecover=!0}this.timeManage.recoverFinish<this.timeManage.nowTime&&!this.isSquishFly&&(this.walk(),this.direction=-1,this.onRecover=!1)}this.flipX=14===this.body.facing,(this.body.blocked.right||this.body.blocked.left)&&(this.direction*=-1),this.body.velocity.x=this.speed*this.direction}}walk(){this.anims.play("koopaWalk_anim"),this.isSquished=!1,this.setSize(16,24),this.setOffset(0,0)}squish(){this.anims.play("koopaSquish_anim"),this.isSquished=!0,this.setSize(16,16),this.setOffset(0,0)}collidingWithPlayer(){this.body.touching.up&&this.scene.player.body.touching.down?this.isSquished?(this.scene.player.x-this.x>=this.body.halfWidth?this.direction=-1:this.direction=1,this.squish(),this.isSquishFly=!0):(this.direction=0,this.body.velocity.x=0,this.anims.stop(),this.squish(),this.scene.player.jump(),this.timeManage.startSquish=this.timeManage.nowTime,this.timeManage.startRecover=this.timeManage.nowTime+this.recoveryInterval,this.timeManage.recoverFinish=this.timeManage.startRecover+this.recoveryInterval):(this.alive&&!this.isSquished&&this.scene.player.eventEmitter.emit("getDamage",this),this.isSquishFly&&this.scene.player.eventEmitter.emit("getDamage",this))}constructor(e,i,s,t){super(e,i,s,t),this.walk(),this.isSquished=!1,this.onRecover=!1,this.isSquishFly=!1,this.recoveryInterval=3e3,this.timeManage={nowTime:0,startSquish:0,startRecover:0,recoverFinish:0}}}class g extends r().Scene{init(e){"{}"===JSON.stringify(e)?this.gameConfig={scene:{score:0},player:{life:3}}:this.gameConfig=e}create(){if(this.score=this.gameConfig.scene.score,this.initRegister(),this.createAnims(),this.createLayer(),this.physics.world.bounds.width=this.graphicLayer.width,this.physics.world.bounds.height=this.graphicLayer.height,this.showDebug=!0,this.debugGraphics=this.add.graphics(),this.drawDebug(),this.input.keyboard.on("keydown_U",e=>{this.showDebug=!this.showDebug,this.drawDebug(),this.player.changeMode("downgrade")}),this.input.keyboard.on("keydown_I",e=>{this.player.changeMode("upgrade")}),this.player=new c({scene:this,x:260,y:110},this.gameConfig.player),this.player.setSize(480,480),"follow"===this.cameraMode)this.cameras.main.setSize(700,224),this.cameras.main.setBounds(0,0,this.level.width,this.level.height),this.cameras.main.startFollow(this.player,!0,1,1,0,100);else{this.cameras.main.setScroll(300,0);let e=this.input.keyboard.createCursorKeys();this.cameras.main,e.left,e.right,e.up,e.down,this.input.keyboard.addKey(r().Input.Keyboard.KeyCodes.Q),this.input.keyboard.addKey(r().Input.Keyboard.KeyCodes.E);let i={camera:this.cameras.main,left:e.left,right:e.right,up:e.up,down:e.down,speed:.5};this.controls=new(r()).Cameras.Controls.FixedKeyControl(i)}this.cameras.main.setBackgroundColor("#63adff"),this.scoreText=this.add.text(80,4,"0").setScrollFactor(0);for(var e=0;e<this.player.life;e++)this.livesIcons=this.add.image(13*(e+1),11,"heart").setScale(.7).setScrollFactor(0);for(var e=0;e<this.player.life;e++)this.livesIcons=this.add.image(13*(e+1),11,"heart").setScale(.7).setScrollFactor(0);this.debugText={},this.events.on("drawDebugEvent",function(){console.log("this.events.on('drawDebugEvent') 参数: "+arguments[0])},this),this.crosshair=this.add.sprite(0,0,"crosshair").setAlpha(0),this.input.on("pointermove",e=>{this.crosshair.setPosition(e.x+this.cameras.main.scrollX,e.y+this.cameras.main.scrollY)}),this.createGroupFromObjects(),this.createCollision()}update(e,i){"keyControl"===this.cameraMode&&this.controls.update(i),this.player.update(e,i),this.updateText()}createLayer(){this.map=this.add.tilemap("level1");let e=this.map.addTilesetImage("tileset_levels");this.graphicLayer=this.map.createDynamicLayer("Graphic_Layer",e,0,0),this.pipesAccessLevelLayer=this.map.createDynamicLayer("PipesAccessLevel",e,0,0),this.pipesAccessLayer=this.map.createDynamicLayer("PipesAccess",e,0,0),this.exitPipesLayer=this.map.createDynamicLayer("ExitPipes",e,0,0),this.finishLevelLayer=this.map.createDynamicLayer("FinishLevel",e,0,0)}drawDebug(){this.debugGraphics.clear(),this.showDebug&&setTimeout(()=>{this.graphicLayer.renderDebug(this.debugGraphics,{tileColor:null,collidingTileColor:new(r()).Display.Color(254,209,16,100)})},1),this.events.emit("drawDebugEvent",1,2)}updateText(){this.scoreText.setText(this.score);for(var e=0;e<this.player.life;e++)this.livesIcons=this.add.image(13*(e+1),11,"heart").setScale(.7).setScrollFactor(0);let i=localStorage.getItem("sustainabilityScore");i&&(i=JSON.parse(i))>0&&(this.perkOne=this.add.image(160,11,"perkOne").setScale(.7).setScrollFactor(0),i>1&&(this.perkTwo=this.add.image(173,11,"perkTwo").setScale(.7).setScrollFactor(0),i>2&&(this.perkThree=this.add.image(186,11,"perkThree").setScale(.7).setScrollFactor(0))))}createAnims(){this.anims.create({key:"randomBox_anim",frames:this.anims.generateFrameNumbers("randomBox",{start:0,end:2}),frameRate:1,repeat:-1}),this.anims.create({key:"brick_anim",frames:this.anims.generateFrameNumbers("brick",{start:0,end:0}),frameRate:1,repeat:1}),this.anims.create({key:"blockCollisioned_anim",frames:this.anims.generateFrameNumbers("blockCollisioned",{start:0,end:0}),frameRate:1,repeat:1}),this.anims.create({key:"goombaWalk_anim",frames:this.anims.generateFrameNumbers("goomba_red",{start:0,end:1}),frameRate:4,repeat:-1}),this.anims.create({key:"goombaDie_anim",frames:this.anims.generateFrameNumbers("goomba_red",{start:2,end:2}),frameRate:1,repeat:1}),this.anims.create({key:"koopaWalk_anim",frames:this.anims.generateFrameNumbers("koopa_green",{start:0,end:1}),frameRate:4,repeat:-1}),this.anims.create({key:"koopaSquish_anim",frames:[{frame:"Enemies/Koopa/koopa green squish 2",key:"atlas_object"}]}),this.anims.create({key:"koopaSquishRecover_anim",frames:this.anims.generateFrameNumbers("koopa_green_squish",{start:0,end:1}),frameRate:6,repeat:6}),this.anims.create({key:"coinBlock_anim",frames:this.anims.generateFrameNumbers("coinBlock",{start:0,end:3}),frameRate:4,repeat:-1}),this.anims.create({key:"mushroom_anim",frames:this.anims.generateFrameNumbers("mushroom",{start:0,end:0}),frameRate:1,repeat:1}),this.anims.create({key:"flower_anim",frames:this.anims.generateFrameNumbers("flower",{start:0,end:3}),frameRate:4,repeat:-1})}createGroupFromObjects(){this.playerAttackGroup=this.add.group(),this.playerAttackGroup.runChildUpdate=!0,this.enemiesGroup=this.add.group(),this.enemiesGroup.runChildUpdate=!0,this.coinsGroup=this.add.group(),this.coinsGroup.runChildUpdate=!0,this.mushroomOrFlowerGroup=this.add.group(),this.mushroomOrFlowerGroup.runChildUpdate=!0,this.flowerGroup=this.add.group(),this.flowerGroup.runChildUpdate=!0;let e=this.map.createFromObjects("Bricks","bricks",{key:"bricks"});this.bricksGroup=this.physics.add.staticGroup(),this.bricksGroup.runChildUpdate=!0,this.objectsAddToGroup(e,"brick_anim",this.bricksGroup),this.map.getObjectLayer("Goombas").objects.forEach(e=>{let i=new p(this,e.x+8,e.y+8,"goomba_red");i._scaleX=.06,i._scaleY=.06,this.enemiesGroup.add(i)}),this.map.getObjectLayer("Koopas").objects.forEach(e=>{let i=new y(this,e.x+8,e.y+8,"koopa_green");i.body.height=e.height,this.enemiesGroup.add(i)});let i=this.map.createFromObjects("DeadZones","deadZones",{key:"deadZones"});this.deadZoneGroup=this.physics.add.staticGroup(),i.forEach((e,i)=>{e.setOrigin(0),e.width=e.width*e._scaleX,e.height=e.height*e._scaleY,e.x=e.x-e.width/2,e.y=e.y+e.height/2,e.setScale(1),e.alpha=0,e.type="deadZone",this.deadZoneGroup.add(e)}),this.bricksCoinGroup=this.physics.add.staticGroup();let s=this.map.createFromObjects("BricksCoin","bricksCoin",{key:"bricksCoin"});this.objectsAddToGroup(s,"randomBox_anim",this.bricksCoinGroup),this.map.getObjectLayer("Coins").objects.forEach(e=>{let i=new o({scene:this,x:e.x+8,y:e.y+8});this.coinsGroup.add(i)}),this.bricksFlowerOrMushroomGroup=this.physics.add.staticGroup();let t=this.map.createFromObjects("BricksFlowerOrMushroom","bricksFlowerOrMushroom",{key:"bricksFlowerOrMushroom"});this.objectsAddToGroup(t,"randomBox_anim",this.bricksFlowerOrMushroomGroup)}objectsAddToGroup(e,i,s){e.forEach((e,t)=>{e.setOrigin(0),e.width=e.width*e._scaleX,e.height=e.height*e._scaleY,e.x=e.x-e.width/2,e.y=e.y+e.height/2,e.setScale(1),e.isCollided=!1,this.anims.play(i,e),s.add(e)})}createCollision(){this.graphicLayer.setCollision([1,34,67,69,265,266,267,268,269,298,299,300,301,301,302]),this.pipesAccessLayer.setCollision([265,266]),this.exitPipesLayer.setCollision([267,300]),this.finishLevelLayer.setCollision([281,314]),this.physics.add.collider(this.player,this.graphicLayer),this.physics.add.collider(this.player,this.pipesAccessLayer,(e,i)=>{e.body.blocked.down&&this.player.keys.down.isDown&&("follow"===this.cameraMode&&this.cameras.main.startFollow(this.player,!0,1,1,0,-100),this.player.setPosition(935,425))}),this.physics.add.collider(this.player,this.exitPipesLayer,(e,i)=>{e.body.blocked.right&&this.player.keys.right.isDown&&("follow"===this.cameraMode&&this.cameras.main.startFollow(this.player,!0,1,1,0,100),this.player.setPosition(2640,143))}),this.physics.add.collider(this.player,this.finishLevelLayer,(e,i)=>{(e.body.blocked.right||e.body.blocked.left)&&this.end("win")}),this.physics.add.collider(this.player,this.coinsGroup,(e,i)=>{i.collidingWithPlayer()}),this.physics.add.collider(this.player,this.bricksCoinGroup,(e,i)=>{e.collidingWithbricksCoinGroup(e,i)}),this.physics.add.collider(this.player,this.bricksFlowerOrMushroomGroup,(e,i)=>{e.collidingWithbricksFlowerOrMushroomGroup(e,i)}),this.physics.add.collider(this.player,this.bricksGroup,(e,i)=>{e.collidingWithbricksGroup(e,i)}),this.physics.add.collider(this.playerAttackGroup,this.graphicLayer,(e,i)=>{e.collided()}),this.physics.add.collider(this.playerAttackGroup,this.enemiesGroup,(e,i)=>{e.explode(),i.collidingWithFireball()}),this.physics.add.overlap(this.player,this.enemiesGroup,(e,i)=>{i.collidingWithPlayer()}),this.physics.add.collider(this.player,this.deadZoneGroup,(e,i)=>{e.eventEmitter.emit("getDamage",i)}),this.physics.add.overlap(this.enemiesGroup,this.deadZoneGroup,(e,i)=>{e.fallInDeadZone()}),this.physics.add.collider(this.enemiesGroup,this.bricksGroup,()=>{}),this.physics.add.collider(this.mushroomOrFlowerGroup,this.bricksGroup,()=>{}),this.physics.add.overlap(this.player,this.mushroomOrFlowerGroup,(e,i)=>{i.collidingWithPlayer(e,i)})}end(e){"restart"===e?this.scene.restart():"lose"===e?(this.cameras.main.fade(1e3,16.5,2,1.2),this.events.emit("gameOver"),this.time.addEvent({delay:1e3,callbackScope:this,callback:()=>{this.scene.start("gameOverScene","lose")}})):"win"===e&&(this.cameras.main.fade(1e3,16.5,2,1.2),this.events.emit("gameOver"),this.time.addEvent({delay:1e3,callbackScope:this,callback:()=>{this.scene.start("gameOverScene","win")}}))}initRegister(){this.registry.set("coins_max","coins_max")}restartGame(){let e={scene:{score:this.score},player:{life:this.player.life}};this.scene.start("GameScene",e)}constructor(){super({key:"GameScene"}),this.cameraMode="follow",this.level={width:3840,height:624}}}class u extends r().Scene{init(e){this.condition=e}create(){let e,i={fill:"#ffffff",align:"center",fontSize:36,fontStyle:"bold",padding:0};this.cameras.main.setBackgroundColor(2753795),"win"===this.condition.result?(e="Victory",this.overText=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2-64,"atlas","win")):"lose"===this.condition.result&&(e="Defeat",this.overText=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2-64,"atlas","gameOver")),this.input.keyboard.on("keydown_ENTER",function(e){location.reload()}),this.cameras.main.stopFollow(),this.cameras.main.setScroll(0,0),this.add.text(100,100,e,i),this.add.text(100,200,"回车重玩",i)}constructor(){super({key:"GameOverScene"})}}class f extends r().Scene{create(){this.title=this.add.sprite(this.sys.game.config.width/2,80,"atlas_object","UI/Menu/title"),this.pressX=this.add.bitmapText(this.sys.game.config.width/2,144,"font","PRESS X TO START",8).setOrigin(.5,.5),setInterval(()=>{this.pressX.alpha=1===this.pressX.alpha?0:1},500)}update(e,i){}constructor(){super({key:"BlankScene"})}}var b=s(12115),k=s(35965),w=s(89984),_=s(93668);let v={type:r().AUTO,pixelArt:!1,roundPixels:!0,parent:"game",title:"Phaser3 Mario",width:700,height:224,fps:60,scale:{mode:r().Scale.WIDTH_CONTROLS_HEIGHT},physics:{default:"arcade",arcade:{gravity:{y:300},debug:!1}},scene:[n,g,u,f]};function x(){let e=(0,k.F)(),i="0xFf055825cDaB483114A3cAaA6Fbd1279b18AD304",{data:s}=(0,w.Q)({address:i,abi:_.HV,functionName:"balanceOf",args:[e.address,0]}),{data:a}=(0,w.Q)({address:i,abi:_.HV,functionName:"balanceOf",args:[e.address,1]}),{data:r}=(0,w.Q)({address:i,abi:_.HV,functionName:"balanceOf",args:[e.address,2]});return!function(e){let i=(0,b.useRef)(null);(0,b.useEffect)(()=>{if(!i.current)return i.current=new Phaser.Game(e),()=>{i.current.destroy(!0),i.current=null}},[]),i.current}(v),(0,b.useEffect)(()=>{let e=0;s&&s>BigInt(0)&&e++,a&&a>BigInt(0)&&e++,r&&r>BigInt(0)&&e++,localStorage.setItem("sustainabilityScore",JSON.stringify(e))},[s,a,r]),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)("div",{id:"game"})})}}}]);